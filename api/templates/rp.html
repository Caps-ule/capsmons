<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>CapsMons ‚Äî RP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{--bg:#0b0f14;--panel:#111826;--panel2:#0f1623;--text:#e6edf3;--muted:#9aa4b2;--border:#233044;--link:#7aa2ff;--shadow:0 12px 30px rgba(0,0,0,.35);--radius:14px}
    [data-theme="light"]{--bg:#fff;--panel:#fff;--panel2:#f7f7f9;--text:#101418;--muted:#5b6777;--border:#e6e8ec;--link:#0b57d0;--shadow:0 10px 24px rgba(0,0,0,.08)}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px;max-width:1100px;background:var(--bg);color:var(--text)}
    a{color:var(--link);text-decoration:none} a:hover{text-decoration:underline}
    .card{border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-top:14px;background:linear-gradient(180deg,var(--panel),var(--panel2));box-shadow:var(--shadow)}
    input,textarea,button{padding:10px 12px;font-size:14px;border-radius:12px;border:1px solid var(--border);background:var(--panel);color:var(--text)}
    textarea{width:100%;min-height:120px;font-family:ui-monospace,Consolas,monospace}
    button{cursor:pointer} button:hover{filter:brightness(1.08)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .muted{color:var(--muted);font-size:13px}
    .topbar{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .toggle{display:flex;gap:8px;align-items:center;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--panel)}
    .toggle input{transform:scale(1.1)}
  </style>
</head>
<body>
  <div class="topbar">
    <div>
      <p><a href="/admin">‚Üê Retour admin</a></p>
      <h1>üìù Phrases RP</h1>
      <div class="muted">1 ligne = 1 phrase. Le bot tirera au hasard dans la cl√©.</div>
    </div>
    <div class="toggle">
      <input type="checkbox" id="themeToggle" checked>
      <label for="themeToggle">Dark mode</label>
    </div>
  </div>

  {% if flash %}
    <div class="card">{{ flash }}</div>
  {% endif %}

  <div class="card">
    <form method="post" action="/admin/rp/save" class="row">
      <input name="key" placeholder="cl√© (ex: creature.stage0)" required style="min-width:300px">
      <button type="submit">Cr√©er cl√© vide</button>
    </form>
    <div class="muted" style="margin-top:8px">Cl√©s conseill√©es: creature.stage0/1/2/3, evolve.announce, cm.assigned, choose.ok, choose.err</div>
  </div>

  {% for item in items %}
  <div class="card">
    <div class="row" style="justify-content:space-between">
      <div><b>{{ item.key }}</b> <span class="muted">({{ item.count }} phrases)</span></div>
      <form method="post" action="/admin/rp/delete">
        <input type="hidden" name="key" value="{{ item.key }}">
        <button type="submit" onclick="return confirm('Supprimer {{ item.key }} ?')">Supprimer</button>
      </form>
    </div>

    <form method="post" action="/admin/rp/save" style="margin-top:10px">
      <input type="hidden" name="key" value="{{ item.key }}">
      <textarea name="lines">{{ item.text }}</textarea>
      <div class="row" style="margin-top:10px">
        <button type="submit">Enregistrer</button>
        <div class="muted">Astuce: lignes vides ignor√©es.</div>
      </div>
    </form>
  </div>
  {% endfor %}

<script>
  (function () {
    const KEY="capsmons_theme";
    const toggle=document.getElementById("themeToggle");
    function apply(t){document.documentElement.setAttribute("data-theme",t);toggle.checked=(t!=="light");}
    apply(localStorage.getItem(KEY)||"dark");
    toggle.addEventListener("change",()=>{const t=toggle.checked?"dark":"light";localStorage.setItem(KEY,t);apply(t);});
  })();
</script>
</body>
</html>
